import { Steps, Callout } from "nextra/components"
import { Code } from "@/components/Code"

<Steps>
### 安装 Auth.js

首先安装适用于您框架的对应包。

<Code>
  <Code.Next>
    
    ```bash npm2yarn
    npm install next-auth@beta
    ```

  </Code.Next>
  <Code.Qwik>

    ```bash npm2yarn
    npm run qwik add auth
    ```

  </Code.Qwik>
  <Code.Svelte>
  
    ```bash npm2yarn
    npm install @auth/sveltekit
    ```
  </Code.Svelte>
  <Code.Express>
  
    ```bash npm2yarn
    npm install @auth/express
    ```
  
  </Code.Express>
</Code>

<Callout type="info">
  无需安装 `@auth/core`，作为用户您永远不需要直接与 `@auth/core` 交互。
</Callout>

### 配置环境变量

唯一必须的环境变量是 `AUTH_SECRET`。这是一个由库用来加密令牌和邮箱验证哈希的随机值（详见[部署指南](/getting-started/deployment)）。您可以通过官方 [Auth.js CLI](https://cli.authjs.dev) 运行以下命令生成：

```bash
npx auth secret
```

该命令会将其添加到您的 `.env` 文件中，并遵循框架约定（例如 Next.js 使用 `.env.local`）。

### 配置认证

接下来创建 Auth.js 配置文件和对象。这里您可以控制库的行为并指定自定义认证逻辑、适配器等。我们建议所有框架在项目中创建 `auth.ts` 文件。在此文件中，我们将所有选项传递给框架特定的初始化函数，然后导出路由处理器、登录/登出方法等。

<Callout type="info">
  您可以随意命名此文件并放置在任何位置，这些只是我们建议的约定。
</Callout>

<Code>
  <Code.Next>

1. 首先在应用根目录创建 `auth.ts` 文件，内容如下：

```ts filename="./auth.ts"
import NextAuth from "next-auth"

export const { handlers, signIn, signOut, auth } = NextAuth({
  providers: [],
})
```

2. 在 `/app/api/auth/[...nextauth]/route.ts` 下添加路由处理器。

<Callout>
  此文件必须是应用路由器的路由处理器，但应用其他部分可以保留在 `page/` 目录下。
</Callout>

```ts filename="./app/api/auth/[...nextauth]/route.ts"
import { handlers } from "@/auth" // 引用刚创建的 auth.ts
export const { GET, POST } = handlers
```

3. 添加可选中间件以保持会话活跃，每次调用时都会更新会话过期时间。

```ts filename="./middleware.ts"
export { auth as middleware } from "@/auth"
```

  </Code.Next>
  <Code.Qwik>

1. 在 `src/routes` 目录创建 `plugin@auth.ts` 文件，内容如下：

```ts filename="/src/routes/plugin@auth.ts"
import { QwikAuth$ } from "@auth/qwik"

export const { onRequest, useSession, useSignIn, useSignOut } = QwikAuth$(
  () => ({
    providers: [...],
  })
)
```

  </Code.Qwik>
  <Code.Svelte>

1. 在 `src/` 目录创建 `auth.ts` 文件，内容如下：

```ts filename="./src/auth.ts"
import { SvelteKitAuth } from "@auth/sveltekit"

export const { handle } = SvelteKitAuth({
  providers: [],
})
```

2. 在 SvelteKit 的 `src/hooks.server.ts` 文件中重新导出 `handle` 方法。

```ts filename="./src/hooks.server.ts"
export { handle } from "./auth"
```

3. 该 handle 函数会在 `event.locals` 上添加 `auth()` 方法，可在任何 `+layout.server.ts` 或 `+page.server.ts` 文件中使用。因此我们可以这样在 `load` 函数中访问会话：

```ts filename="./src/routes/+layout.server.ts" {4}
import type { LayoutServerLoad } from "./$types"

export const load: LayoutServerLoad = async (event) => {
  const session = await event.locals.auth()

  return {
    session,
  }
}
```

  </Code.Svelte>
  <Code.Express>

1. 导入 `ExpressAuth` 并将处理器添加到认证路由。

```ts filename="./src/routes/auth.route.ts" {1, 9}
import { ExpressAuth } from "@auth/express"
import express from "express"

const app = express()

// 如果您的应用通过代理提供服务
// 信任代理以允许读取 `X-Forwarded-*` 头信息
app.set("trust proxy", true)
app.use("/auth/*", ExpressAuth({ providers: [] }))
```

注意这创建了 Auth.js API，但尚未保护资源。继续阅读[资源保护](/getting-started/session-management/protecting)获取更多细节。

  </Code.Express>
</Code>

### 设置认证方法

至此基础配置已完成！接下来我们将设置第一个认证方法并填充 `providers` 数组。

</Steps>
