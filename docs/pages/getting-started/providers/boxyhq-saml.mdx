import { Callout } from "nextra/components"
import { Code } from "@/components/Code"

<img
  align="right"
  src="/img/providers/boxyhq-saml.svg"
  height="64"
  width="64"
/>

# BoxyHQ SAML 提供商

## 相关资源

- [BoxyHQ OAuth 文档](https://boxyhq.com/docs/jackson/overview)

## 配置

为您的页面添加 BoxyHQ SAML 登录功能。

BoxyHQ SAML 是一项开源服务，它将 SAML SSO 登录流程作为 OAuth 2.0 流程处理，抽象了 SAML 协议的所有复杂性。轻松为您的应用程序启用企业单点登录。

您可以将 BoxyHQ SAML 部署为独立服务，或通过我们的 NPM 库将其嵌入到应用中。[查看文档了解更多详情](https://boxyhq.com/docs/jackson/deploy)

### 回调 URL

<Code>
  <Code.Next>

```bash
https://example.com/api/auth/callback/boxyhq-saml
```

  </Code.Next>
  <Code.Qwik>

```bash
https://example.com/auth/callback/boxhq-saml
```

  </Code.Qwik>
  <Code.Svelte>

```bash
https://example.com/auth/callback/boxhq-saml
```

  </Code.Svelte>
</Code>

### 环境变量

```
AUTH_BOXYHQ_SAML_ID
AUTH_BOXYHQ_SAML_SECRET
AUTH_BOXYHQ_SAML_ISSUER
```

### 配置

<Code>
  <Code.Next>

```ts filename="/auth.ts"
import NextAuth from "next-auth"
import BoxyHQ from "next-auth/providers/boxyhq-saml"

export const { handlers, auth, signIn, signOut } = NextAuth({
  providers: [
    BoxyHQ({
      authorization: { params: { scope: "" } }, // This is needed for OAuth 2.0 flow, otherwise default to openid
      clientId: AUTH_BOXYHQ_SAML_ID,
      clientSecret: AUTH_BOXYHQ_SAML_SECRET,
      issuer: AUTH_BOXYHQ_SAML_ISSUER,
    }),
  ],
})
```

  </Code.Next>
  <Code.Qwik>
  
```ts filename="/src/routes/plugin@auth.ts"
import { QwikAuth$ } from "@auth/qwik"
import BoxyHQ from "@auth/qwik/providers/boxyhq-saml"

export const { onRequest, useSession, useSignIn, useSignOut } = QwikAuth$(
  () => ({
    providers: [
      BoxyHQ({
        authorization: { params: { scope: "" } }, // This is needed for OAuth 2.0 flow, otherwise default to openid
        clientId: import.meta.env.AUTH_BOXYHQ_SAML_ID,
        clientSecret: import.meta.env.AUTH_BOXYHQ_SAML_SECRET,
        issuer: import.meta.env.AUTH_BOXYHQ_SAML_ISSUER,
      }),  
    ],
  })
)
```

  </Code.Qwik>
  <Code.Svelte>

```ts filename="/src/auth.ts"
import { SvelteKitAuth } from "@auth/sveltekit"
import BoxyHQ from "@auth/sveltekit/providers/boxyhq-saml"

export const { handle, signIn, signOut } = SvelteKitAuth({
  providers: [
    BoxyHQ({
      authorization: { params: { scope: "" } }, // This is needed for OAuth 2.0 flow, otherwise default to openid
      clientId: AUTH_BOXYHQ_SAML_ID,
      clientSecret: AUTH_BOXYHQ_SAML_SECRET,
      issuer: AUTH_BOXYHQ_SAML_ISSUER,
    }),
  ],
})
```

  </Code.Svelte>
  <Code.Express>

```ts filename="/src/app.ts"
import { ExpressAuth } from "@auth/express"
import BoxyHQ from "@auth/express/providers/boxyhq-saml"

app.use(
  "/auth/*",
  ExpressAuth({
    providers: [
      BoxyHQ({
        authorization: { params: { scope: "" } }, // This is needed for OAuth 2.0 flow, otherwise default to openid
        clientId: AUTH_BOXYHQ_SAML_ID,
        clientSecret: AUTH_BOXYHQ_SAML_SECRET,
        issuer: AUTH_BOXYHQ_SAML_ISSUER,
      }),
    ],
  })
)
```

  </Code.Express>
</Code>

### SAML

SAML 登录需要为每个租户进行配置。常见方法是通过电子邮件地址的域名来识别所属租户。您也可以使用来自后端的唯一租户 ID（字符串），通常是某种账户或组织 ID。

[查看文档](https://boxyhq.com/docs/jackson/saml-flow#2-saml-config-api)了解更多详情。

在客户端，您需要向 `signIn` 函数传递额外的参数 `tenant` 和 `product`。这将使 BoxyHQL SAML 能够识别正确的 SAML 配置，并将用户引导至正确的 SAML 身份提供商进行登录。

```ts
import { signIn } from "next-auth/react";

// Map your users's email to a tenant and product
const tenant = email.split("@")[1];
const product = 'my_awesome_product';

<Button
  onClick={async (event) => {
    event.preventDefault();

    signIn("boxyhq-saml", {}, { tenant, product });
  }}
>
```
