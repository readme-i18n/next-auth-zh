import { Callout } from "nextra/components"
import { Code } from "@/components/Code"

<img align="right" src="/img/providers/wikimedia.svg" height="64" width="64" />

# Wikimedia 提供商

## 相关资源

- [Wikimedia OAuth 文档](https://www.mediawiki.org/wiki/Extension:OAuth)

## 配置

### 回调 URL

<Code>
  <Code.Next>

```bash
https://example.com/api/auth/callback/wikimedia
```

  </Code.Next>
  <Code.Qwik>

```bash
https://example.com/auth/callback/wikimedia
```

  </Code.Qwik>
  <Code.Svelte>

```bash
https://example.com/auth/callback/wikimedia
```

  </Code.Svelte>
</Code>

### 环境变量

```
AUTH_WIKIMEDIA_ID
AUTH_WIKIMEDIA_SECRET
```

### 配置

<Code>
  <Code.Next>

```ts filename="/auth.ts"
import NextAuth from "next-auth"
import Wikimedia from "next-auth/providers/wikimedia"

export const { handlers, auth, signIn, signOut } = NextAuth({
  providers: [Wikimedia],
})
```

  </Code.Next>
  <Code.Qwik>
  
```ts filename="/src/routes/plugin@auth.ts"
import { QwikAuth$ } from "@auth/qwik"
import Wikimedia from "@auth/qwik/providers/wikimedia"

export const { onRequest, useSession, useSignIn, useSignOut } = QwikAuth$(
  () => ({
    providers: [Wikimedia],
  })
)
```

  </Code.Qwik>
  <Code.Svelte>

```ts filename="/src/auth.ts"
import { SvelteKitAuth } from "@auth/sveltekit"
import Wikimedia from "@auth/sveltekit/providers/wikimedia"

export const { handle, signIn, signOut } = SvelteKitAuth({
  providers: [Wikimedia],
})
```

  </Code.Svelte>
  <Code.Express>

```ts filename="/src/app.ts"
import { ExpressAuth } from "@auth/express"
import Wikimedia from "@auth/express/providers/wikimedia"

app.use("/auth/*", ExpressAuth({ providers: [Wikimedia] }))
```

  </Code.Express>
</Code>

- 访问并接受消费者注册文档：https://meta.wikimedia.org/wiki/Special:OAuthConsumerRegistration
- 申请新的 OAuth 2.0 消费者以获取 `clientId` 和 `clientSecret`：https://meta.wikimedia.org/wiki/Special:OAuthConsumerRegistration/propose/oauth2
  - 在控制台添加以下重定向 URL：`http://<your-next-app-url>/api/auth/callback/wikimedia`
  - 不要勾选 **仅限您的用户名使用此消费者** 的复选框
  - 除非明确需要更大权限范围，否则建议选择标有"仅用户身份验证 - 无读取页面或代表用户操作的权限"的单选框

注册后，您最初只能使用自己的 Wikimedia 账户测试应用程序。
可能需要等待数天申请获批后，才能供所有用户使用。

### 注意事项

该提供商同时支持所有 Wikimedia 项目：

- 维基百科
- 维基数据
- 维基教科书
- 维基词典
- 等等...

请注意 Wikimedia 账户不一定关联电子邮箱。因此您可能需要先检查用户是否拥有邮箱地址，再允许其登录。
