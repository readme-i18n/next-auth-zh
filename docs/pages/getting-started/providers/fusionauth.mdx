import { Callout } from "nextra/components"
import { Code } from "@/components/Code"

<img align="right" src="/img/providers/fusionauth.svg" height="64" width="64" />

# Fusion Auth

## 相关资源

- [FusionAuth OAuth 文档](https://fusionauth.io/docs/v1/tech/oauth/)
- [FusionAuth 5分钟快速设置指南](https://fusionauth.io/docs/v1/tech/5-minute-setup-guide).

## 配置

### 回调 URL

<Code>
  <Code.Next>

```bash
https://example.com/api/auth/callback/fusionauth
```

  </Code.Next>
  <Code.Qwik>

```bash
https://example.com/auth/callback/fusionauth
```

  </Code.Qwik>
  <Code.Svelte>

```bash
https://example.com/auth/callback/fusionauth
```

  </Code.Svelte>
</Code>

### 环境变量

```
AUTH_FUSIONAUTH_ID
AUTH_FUSIONAUTH_SECRET
AUTH_FUSIONAUTH_TENANT_ID
AUTH_FUSIONAUTH_ISSUER
```

### 配置

<Code>
  <Code.Next>

```ts filename="/auth.ts"
import NextAuth from "next-auth"
import FusionAuth from "next-auth/providers/fusionauth"

export const { handlers, auth, signIn, signOut } = NextAuth({
  providers: [
    FusionAuth({
      clientId: process.env.AUTH_FUSIONAUTH_ID,
      clientSecret: process.env.AUTH_FUSIONAUTH_SECRET,
      tenantId: process.env.AUTH_FUSIONAUTH_TENANT_ID,
      issuer: process.env.AUTH_FUSIONAUTH_ISSUER,
    }),
  ],
})
```

  </Code.Next>
  <Code.Qwik>
  
```ts filename="/src/routes/plugin@auth.ts"
import { QwikAuth$ } from "@auth/qwik"
import FusionAuth from "@auth/qwik/providers/fusionauth"

export const { onRequest, useSession, useSignIn, useSignOut } = QwikAuth$(
  () => ({
    providers: [
      FusionAuth({
        clientId: import.meta.env.AUTH_FUSIONAUTH_ID,
        clientSecret: import.meta.env.AUTH_FUSIONAUTH_SECRET,
        tenantId: import.meta.env.AUTH_FUSIONAUTH_TENANT_ID,
        issuer: import.meta.env.AUTH_FUSIONAUTH_ISSUER,
      }),
    ],
  })
)
```

  </Code.Qwik>
  <Code.Svelte>

```ts filename="/src/auth.ts"
import { SvelteKitAuth } from "@auth/sveltekit"
import FusionAuth from "@auth/sveltekit/providers/fusionauth"
import {
  AUTH_FUSIONAUTH_ID,
  AUTH_FUSIONAUTH_SECRET,
  AUTH_FUSIONAUTH_TENANT_ID,
  AUTH_FUSIONAUTH_ISSUER,
} from "$env/static/private"

export const { handle, signIn, signOut } = SvelteKitAuth({
  providers: [
    FusionAuth({
      clientId: AUTH_FUSIONAUTH_ID,
      clientSecret: AUTH_FUSIONAUTH_SECRET,
      tenantId: AUTH_FUSIONAUTH_TENANT_ID,
      issuer: AUTH_FUSIONAUTH_ISSUER,
    }),
  ],
})
```

  </Code.Svelte>
  <Code.Express>

```ts filename="/src/app.ts"
import { ExpressAuth } from "@auth/express"
import FusionAuth from "@auth/express/providers/fusionauth"

app.use(
  "/auth/*",
  ExpressAuth({
    providers: [
      FusionAuth({
        clientId: process.env.AUTH_FUSIONAUTH_ID,
        clientSecret: process.env.AUTH_FUSIONAUTH_SECRET,
        tenantId: process.env.AUTH_FUSIONAUTH_TENANT_ID,
        issuer: process.env.AUTH_FUSIONAUTH_ISSUER,
      }),
    ],
  })
)
```

  </Code.Express>
</Code>

<Callout type="warning">
  如果使用多租户功能，必须传入 tenantId 参数以应用正确的主题样式。
</Callout>

### 注意事项

- 可通过 `https://your-fusionauth-server-url/admin/application` 创建应用

在应用的 OAuth 设置中配置以下内容：

- 回调地址
  - https://localhost:3000/api/auth/callback/fusionauth
- 启用授权类型
  - 确保已启用 _授权码模式_

若使用 JSON Web Tokens，需确保签名算法为 RS256。可通过以下步骤创建密钥对：进入 Settings → Key Master → 生成 RSA 密钥并选择 SHA-256 算法。完成后进入应用的 JWT 设置，将此密钥选为访问令牌签名密钥和 ID 令牌签名密钥。
