import { Callout, Steps } from "nextra/components"
import { Code } from "@/components/Code"

# é…ç½® OAuth æä¾›å•†

## è¦†ç›–é»˜è®¤æä¾›å•†é…ç½®

å¯¹äºå†…ç½®æä¾›å•†ï¼Œé€šå¸¸æ‚¨åªéœ€æŒ‡å®šå®¢æˆ·ç«¯ID(client id)å’Œå®¢æˆ·ç«¯å¯†é’¥(client secret)ï¼Œå¦‚æœæ˜¯OIDC(OpenID Connect)åˆ™è¿˜éœ€æŒ‡å®šé¢å‘è€…(issuer)ã€‚
æˆ‘ä»¬å¯ä»¥[ä»ç¯å¢ƒå˜é‡ä¸­æ¨æ–­è¿™äº›å€¼](/guides/environment-variables#oauth-variables)ã€‚

å¦‚éœ€è¦†ç›–ä»»ä½•é»˜è®¤æä¾›å•†é…ç½®é€‰é¡¹ï¼Œæ‚¨å¯ä»¥åœ¨æä¾›å•†çš„å‡½æ•°è°ƒç”¨ä¸­æ·»åŠ å®ƒä»¬ï¼Œè¿™äº›é€‰é¡¹å°†ä¸æˆ‘ä»¬çš„[é»˜è®¤é…ç½®](https://github.com/nextauthjs/next-auth/tree/main/packages/core/src/providers)è¿›è¡Œæ·±åº¦åˆå¹¶ã€‚
è¿™æ„å‘³ç€æ‚¨åªéœ€è¦†ç›–éœ€è¦å˜æ›´çš„éƒ¨åˆ†é€‰é¡¹ã€‚ä¾‹å¦‚è‹¥éœ€è°ƒæ•´ä½œç”¨åŸŸ(scope)ï¼Œä»…éœ€è¦†ç›–`authorization.params.scope`è€Œéæ•´ä¸ª`authorization`é€‰é¡¹ã€‚

ä¾‹å¦‚ï¼Œè¦è¦†ç›–æä¾›å•†é»˜è®¤çš„`scope`ï¼Œæ‚¨å¯ä»¥å¦‚ä¸‹æ“ä½œï¼š

<Code>
<Code.Next>
```ts filename="./auth.ts"
import NextAuth from "next-auth";
import Auth0 from "next-auth/providers/auth0";

export const { handlers, auth } = NextAuth({
  providers: [
    Auth0({ authorization: { params: { scope: "openid custom_scope" } } }),
  ],
});
```
</Code.Next>
<Code.Qwik>
  
```ts filename="/src/routes/plugin@auth.ts"
import { QwikAuth$ } from "@auth/qwik"
import Auth0 from "@auth/qwik/providers/auth0";

export const { onRequest, useSession, useSignIn, useSignOut } = QwikAuth$(
  () => ({
    providers: [
      Auth0({ authorization: { params: { scope: "openid custom_scope" } } }),
    ],
  })
)
```

</Code.Qwik>
<Code.Svelte>
```ts filename="src/auth.ts"
import { SvelteKitAuth } from "@auth/sveltekit";
import Auth0 from "@auth/sveltekit/providers/auth0";

export const { handle, signIn } = SvelteKitAuth({
  providers: [
    Auth0({ authorization: { params: { scope: "openid custom_scope" } } }),
  ],
});
```

```ts filename="src/hooks.server.ts"
export { handle } from "./auth"
```

</Code.Svelte>
</Code>

å¦ä¸€ä¸ªä¾‹å­ï¼Œé»˜è®¤æƒ…å†µä¸‹`profile`å›è°ƒä¼šè¿”å›`name`ã€`email`å’Œ`picture`ï¼Œä½†æ‚¨å¯èƒ½å¸Œæœ›ä»æä¾›å•†è·å–æ›´å¤šä¿¡æ¯ã€‚æ‚¨è¿”å›çš„å†…å®¹å°†ç”¨äºåˆ›å»ºæ•°æ®åº“ä¸­çš„ç”¨æˆ·å¯¹è±¡ã€‚

<Code>
<Code.Next>
```ts filename="./auth.ts"
import NextAuth from "next-auth";
import Auth0 from "next-auth/providers/auth0";

export const { handlers, auth } = NextAuth({
  providers: [
    Auth0({
      // You can also make calls to external resources if necessary.
      async profile(profile) {
        return {};
      },
    }),
  ],
});
```
</Code.Next>
<Code.Qwik>
  
```ts filename="/src/routes/plugin@auth.ts"
import { QwikAuth$ } from "@auth/qwik"
import Auth0 from "@auth/qwik/providers/auth0";

export const { onRequest, useSession, useSignIn, useSignOut } = QwikAuth$(
  () => ({
    providers: [
      Auth0({
        // You can also make calls to external resources if necessary.
        async profile(profile) {
          return {};
        },
      }),
    ],
  })
)
```

</Code.Qwik>
<Code.Svelte>
```ts filename="src/auth.ts"
import { SvelteKitAuth } from "@auth/sveltekit";
import Auth0 from "@auth/sveltekit/providers/auth0";

export const { handle } = SvelteKitAuth({
  providers: [
    Auth0({
      // You can also make calls to external resources if necessary.
      async profile(profile) {
        return {};
      },
    }),
  ],
});
```

```ts filename="src/hooks.server.ts"
export { handle } from "./auth"
```

</Code.Svelte>
</Code>

## ä½¿ç”¨è‡ªå®šä¹‰æä¾›å•†

<Callout>
  åœ¨ä»å¤´åˆ›å»ºæä¾›å•†å‰ï¼Œè¯·å…ˆæŸ¥çœ‹æˆ‘ä»¬çš„[å†…ç½®OAuthæä¾›å•†](/getting-started/authentication/oauth)ã€‚
</Callout>

æˆ‘ä»¬æ”¯æŒä»»ä½•ç¬¦åˆ [OAuth](https://datatracker.ietf.org/doc/html/rfc6749) æˆ– [OIDC](https://openid.net/specs/openid-connect-core-1_0.html) è§„èŒƒçš„æä¾›å•†ã€‚
é¦–å…ˆå‘ [`providers` åˆ—è¡¨](/reference/core#providers) ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼š

<Code>
<Code.Next>
```ts filename="./auth.ts"
import NextAuth from "next-auth";

export const { handlers, auth } = NextAuth({
  providers: [{
    id: "my-provider", // signIn("my-provider") and will be part of the callback URL
    name: "My Provider", // optional, used on the default login page as the button text.
    type: "oidc", // or "oauth" for OAuth 2 providers
    issuer: "https://my.oidc-provider.com", // to infer the .well-known/openid-configuration URL
    clientId: process.env.AUTH_CLIENT_ID, // from the provider's dashboard
    clientSecret: process.env.AUTH_CLIENT_SECRET, // from the provider's dashboard
  }],
});
```
</Code.Next>
<Code.Qwik>
  
```ts filename="/src/routes/plugin@auth.ts"
import { QwikAuth$ } from "@auth/qwik"

export const { onRequest, useSession, useSignIn, useSignOut } = QwikAuth$(
  () => ({
    providers: [{
      id: "my-provider", // signIn("my-provider") and will be part of the callback URL
      name: "My Provider", // optional, used on the default login page as the button text.
      type: "oidc", // or "oauth" for OAuth 2 providers
      issuer: "https://my.oidc-provider.com", // to infer the .well-known/openid-configuration URL
      clientId: import.meta.env.AUTH_CLIENT_ID, // from the provider's dashboard
      clientSecret: import.meta.env.AUTH_CLIENT_SECRET, // from the provider's dashboard
    }],
  })
)
```

</Code.Qwik>
<Code.Svelte>
```ts filename="src/auth.ts"
import { SvelteKitAuth } from "@auth/sveltekit";

export const { handle } = SvelteKitAuth({
  providers: [{
    id: "my-provider", // signIn("my-provider") and will be part of the callback URL
    name: "My Provider", // optional, used on the default login page as the button text.
    type: "oidc", // or "oauth" for OAuth 2 providers
    issuer: "https://my.oidc-provider.com", // to infer the .well-known/openid-configuration URL
    clientId: process.env.AUTH_CLIENT_ID, // from the provider's dashboard
    clientSecret: process.env.AUTH_CLIENT_SECRET, // from the provider's dashboard
  }],
});
```

```ts filename="src/hooks.server.ts"
export { handle } from "./auth"
```

</Code.Svelte>
</Code>

ç„¶ååœ¨æä¾›å•†çš„æ§åˆ¶é¢æ¿ä¸­å°† [å›è°ƒ URL](https://www.ietf.org/archive/id/draft-ietf-oauth-v2-1-07.html#name-client-redirection-endpoint) è®¾ç½®ä¸º `https://app.com/{basePath}/callback/{id}`ã€‚

<Callout type="info">
  é»˜è®¤æƒ…å†µä¸‹ï¼ŒNext.js çš„ `basePath` æ˜¯ `/api/auth`ï¼Œå…¶ä»–æ‰€æœ‰é›†æˆä¸­åˆ™ä¸º
  `/auth`ã€‚è¯¦è§ [`basePath`](/reference/core#basepath)ã€‚
</Callout>

è¿™æ ·å°±å®Œæˆäº†ï¼ğŸ‰

## æ·»åŠ æ–°çš„å†…ç½®æä¾›å•†

å¦‚æœæ‚¨è®¤ä¸ºè‡ªå®šä¹‰æä¾›å•†å¯èƒ½å¯¹ä»–äººæœ‰ç”¨ï¼Œæˆ‘ä»¬é¼“åŠ±æ‚¨æäº¤ PR å°†å…¶æ·»åŠ åˆ°å†…ç½®åˆ—è¡¨ä¸­ã€‚

<Steps>

### åˆ›å»ºæä¾›è€…æ–‡ä»¶

åœ¨ [`packages/core/src/providers`](https://github.com/nextauthjs/next-auth/tree/main/packages/core/src/providers) ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª `{provider}.ts` æ–‡ä»¶ã€‚

### éµå¾ªä»£ç è§„èŒƒ

å‚è€ƒ[å†…ç½®æä¾›è€…](https://github.com/nextauthjs/next-auth/tree/main/packages/core/src/providers)çš„å®ç°æ–¹å¼ï¼Œç¡®ä¿æ‚¨çš„æä¾›è€…éµå¾ªç›¸åŒçš„ä»£ç è§„èŒƒï¼Œä¾‹å¦‚ï¼š

- ä½¿ç”¨ TypeScript
- ä½¿ç”¨å‘½åé»˜è®¤å¯¼å‡ºï¼š`export default function YourProvider`
- å¯¼å‡ºå®šä¹‰æä¾›è€…ç”¨æˆ·ä¿¡æ¯å±æ€§çš„ TypeScript `interface`
- æ·»åŠ å¿…è¦çš„ JSDoc æ³¨é‡Š/æ–‡æ¡£ã€‚ä¾‹å¦‚ [Auth0 æä¾›è€…](https://github.com/nextauthjs/next-auth/blob/main/packages/core/src/providers/auth0.ts)æ˜¯ OIDC çš„ä¼˜ç§€ç¤ºä¾‹ï¼Œè€Œ [GitHub æä¾›è€…](https://github.com/nextauthjs/next-auth/blob/main/packages/core/src/providers/github.ts)åˆ™æ˜¯ OAuth æä¾›è€…çš„èŒƒä¾‹ã€‚
- æ·»åŠ æŒ‡å‘æä¾›è€… API å‚è€ƒ/æ–‡æ¡£çš„é“¾æ¥ï¼Œæ–¹ä¾¿ä»–äººäº†è§£å¦‚ä½•é…ç½®è¯¥æä¾›è€…

### åœ¨ GitHub é—®é¢˜ä¸‹æ‹‰èœå•ä¸­æ·»åŠ æ‚¨çš„æä¾›è€…

å°†æ–°æä¾›è€…åç§°æ·»åŠ åˆ° [`æä¾›è€…é—®é¢˜æ¨¡æ¿`](https://github.com/nextauthjs/next-auth/edit/main/.github/ISSUE_TEMPLATE/2_bug_provider.yml) çš„ `Provider type` ä¸‹æ‹‰é€‰é¡¹ä¸­

### æ·»åŠ å¾½æ ‡

å°†å¾½æ ‡æ–‡ä»¶ `{provider}.svg` æ·»åŠ åˆ° [`docs/static/img/providers`](https://github.com/nextauthjs/next-auth/tree/main/docs/static/img/providers) ç›®å½•ã€‚

</Steps>

å½“ PR åˆå¹¶åï¼Œå…¶ä»–å¼€å‘è€…ä¹Ÿèƒ½é€šè¿‡æˆ‘ä»¬çš„ä»»ä½•é›†æˆå‘ç°å¹¶ä½¿ç”¨è¯¥æä¾›è€…ã€‚å¤§åŠŸå‘Šæˆï¼ğŸ‰
