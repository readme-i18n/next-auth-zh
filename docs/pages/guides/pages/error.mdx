import { Code } from "@/components/Code"
import { Screenshot } from "@/components/Screenshot"

# 自定义错误页面

当用户认证流程（登录、登出等）出现问题时，可以配置 Auth.js 显示自定义错误页面。

要覆盖 Auth.js 默认的 `/api/auth/error` 页面，我们需要在 AuthConfig 中定义自定义页面：

<Code>
<Code.Next>

```ts filename="./auth.ts"
const authConfig: NextAuthConfig = {
...
  pages: {
    error: "/error",
  }
...
};
```

</Code.Next>
</Code>

以[示例应用](https://github.com/nextauthjs/next-auth-example)为基础，通过创建 `app/error/page.tsx` 来构建一个简单的自定义错误页面：

<Code>
<Code.Next>

```tsx filename="app/error/page.tsx"
export default function AuthErrorPage() {
  return <>Oops</>
}
```

</Code.Next>
</Code>

Auth.js 会将以下错误作为 URL 查询参数转发到我们的自定义错误页面：

| 查询参数        | 示例 URL                          | 描述                                               |
| --------------- | --------------------------------- | -------------------------------------------------- |
| `Configuration` | `/auth/error?error=Configuration` | 服务器配置存在问题。请检查您的选项是否正确。       |
| `AccessDenied`  | `/auth/error?error=AccessDenied`  | 通常发生在通过 signIn 回调或重定向回调限制访问时。 |
| `Verification`  | `/auth/error?error=Verification`  | 与 Email 提供商相关。令牌已过期或已被使用。        |
| `Default`       | `/auth/error?error=Default`       | 全局捕获，当以上都不匹配时适用。                   |

现在我们可以用它来更新自定义错误页面：

<Code>
<Code.Next>

```tsx filename="app/error/page.tsx"
"use client"

import { useSearchParams } from "next/navigation"

enum Error {
  Configuration = "Configuration",
}

const errorMap = {
  [Error.Configuration]: (
    <p>
      There was a problem when trying to authenticate. Please contact us if this
      error persists. Unique error code:{" "}
      <code className="rounded-sm bg-slate-100 p-1 text-xs">Configuration</code>
    </p>
  ),
}

export default function AuthErrorPage() {
  const search = useSearchParams()
  const error = search.get("error") as Error

  return (
    <div className="flex h-screen w-full flex-col items-center justify-center">
      <a
        href="#"
        className="block max-w-sm rounded-lg border border-gray-200 bg-white p-6 text-center shadow hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-800 dark:hover:bg-gray-700"
      >
        <h5 className="mb-2 flex flex-row items-center justify-center gap-2 text-xl font-bold tracking-tight text-gray-900 dark:text-white">
          Something went wrong
        </h5>
        <div className="font-normal text-gray-700 dark:text-gray-400">
          {errorMap[error] || "Please contact us if this error persists."}
        </div>
      </a>
    </div>
  )
}
```

</Code.Next>
</Code>

当发生错误时，Auth.js 会将用户重定向到我们的自定义错误页面：

import CustomErrorPage from "../../../public/img/tutorials/custom-error-page.webp"

<Screenshot src={CustomErrorPage} alt="Custom Error Page" />
